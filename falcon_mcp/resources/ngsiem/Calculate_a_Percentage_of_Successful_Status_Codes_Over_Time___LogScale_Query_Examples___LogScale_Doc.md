# Calculate a Percentage of Successful Status Codes Over Time | LogScale Query Examples | LogScale Documentation

**URL:** https://library.humio.com/examples/examples-if-8.html
**Subdomain:** library
**Description:** 

---

[Falcon LogScale Documentation](https://library.humio.com)

/ [LogScale Query Examples](examples.html)

## Calculate a Percentage of Successful Status Codes Over Time

### Query

flowchart LR; %%{init: {"flowchart": {"defaultRenderer": "elk"}} }%% repo{{Events}} 1{Conditional} 2{{Aggregate}} 3{{Aggregate}} 4[/Drop Field\\] result{{Result Set}} repo --> 1 1 --> 2 2 --> 3 3 --> 4 4 --> result style 4 fill:#2ac76d; click 4 #examples-if-8-4

logscale
    
    
    | success := if(status >= 500, then=0, else=1)
    | timeChart(series=customer,function=
    [
      {
        [sum(success,as=success),count(as=total)]
    | pct_successful := (success/total)*100
    | drop([success,total])}],span=15m,limit=100)

### Introduction

Calculate a percentage of successful status codes inside the [`timeChart()`](https://library.humio.com/data-analysis/functions-timechart.html) function field. 

### Step-by-Step

  1. Starting with the source repository events.

  2. flowchart LR; %%{init: {"flowchart": {"defaultRenderer": "elk"}} }%% repo{{Events}} 1{Conditional} 2{{Aggregate}} 3{{Aggregate}} 4[/Drop Field\\] result{{Result Set}} repo --> 1 1 --> 2 2 --> 3 3 --> 4 4 --> result style 4 fill:#2ac76d; click 4 #examples-if-8-4 style 1 fill:#ff0000,stroke-width:4px,stroke:#000;

logscale
         
         | success := if(status >= 500, then=0, else=1)

Adds a success field at the following conditions: 

     * If the value of field status is greater than or equal to `500`, set the value of success to `0`, otherwise to `1`. 

  3. flowchart LR; %%{init: {"flowchart": {"defaultRenderer": "elk"}} }%% repo{{Events}} 1{Conditional} 2{{Aggregate}} 3{{Aggregate}} 4[/Drop Field\\] result{{Result Set}} repo --> 1 1 --> 2 2 --> 3 3 --> 4 4 --> result style 4 fill:#2ac76d; click 4 #examples-if-8-4 style 2 fill:#ff0000,stroke-width:4px,stroke:#000;

logscale
         
         | timeChart(series=customer,function=
         [
           {
             [sum(success,as=success),count(as=total)]

Creates a new timechart, generating a new series, customer that uses a compound function. In this example, the embedded function is generating an array of values, but the array values are generated by an embedded aggregate. The embedded aggregate (defined using the `{}` syntax), creates a [`sum()`](https://library.humio.com/data-analysis/functions-sum.html) and [`count()`](https://library.humio.com/data-analysis/functions-count.html) value across the events grouped by the value of success field generated from the filter query. This is counting the `1`1 or `0` generated by the [`if()`](https://library.humio.com/data-analysis/functions-if.html) function; counting all the values and adding up the ones for successful values. These values will be assigned to the success and total fields. Note that at this point we are still within the aggregate, so the two new fields are within the context of the aggregate, with each field being created for a corresponding success value. 

  4. flowchart LR; %%{init: {"flowchart": {"defaultRenderer": "elk"}} }%% repo{{Events}} 1{Conditional} 2{{Aggregate}} 3{{Aggregate}} 4[/Drop Field\\] result{{Result Set}} repo --> 1 1 --> 2 2 --> 3 3 --> 4 4 --> result style 4 fill:#2ac76d; click 4 #examples-if-8-4 style 3 fill:#ff0000,stroke-width:4px,stroke:#000;

logscale
         
         | pct_successful := (success/total)*100

Calculates the percentage that are successful. We are still within the aggregate, so the output of this process will be an embedded set of events with the total and success values grouped by each original HTTP response code. 

  5. flowchart LR; %%{init: {"flowchart": {"defaultRenderer": "elk"}} }%% repo{{Events}} 1{Conditional} 2{{Aggregate}} 3{{Aggregate}} 4[/Drop Field\\] result{{Result Set}} repo --> 1 1 --> 2 2 --> 3 3 --> 4 4 --> result style 4 fill:#2ac76d; click 4 #examples-if-8-4 style 4 fill:#ff0000,stroke-width:4px,stroke:#000;

logscale
         
         | drop([success,total])}],span=15m,limit=100)

Still within the embedded aggregate, drop the total and success fields from the array generated by the aggregate. These fields were temporary to calculate the percentage of successful results, but are not needed in the array for generating the result set. Then, set a span for the buckets for the events of 15 minutes and limit to 100 results overall. 

  6. Event Result set.




### Summary and Results

This query shows how an embedded aggregate can be used to generate a sequence of values that can be formatted (in this case to calculate percentages) and generate a new event series for the aggregate values.
